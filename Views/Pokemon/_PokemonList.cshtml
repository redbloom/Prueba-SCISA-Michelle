@model Prueba_SCISA_Michelle.Models.Dtos.PagedResult<Prueba_SCISA_Michelle.Models.Dtos.PokemonListItemDto>

@{
    var page = Model.Page;
    var totalPages = Model.TotalPages;
    var total = Model.TotalCount;
    var size = Model.PageSize;

    int window = 2;
    int start = Math.Max(1, page - window);
    int end = Math.Min(totalPages, page + window);

    if (end - start < window * 2)
    {
        if (start == 1)
            end = Math.Min(totalPages, start + window * 2);
        else if (end == totalPages)
            start = Math.Max(1, end - window * 2);
    }

    var first = (total == 0) ? 0 : ((page - 1) * size) + 1;
    var last = Math.Min(page * size, total);
}

@if (!Model.Items.Any())
{
    <div class="text-center py-5 text-muted">No se encontraron resultados.</div>
}
else
{
    <div class="table-responsive">
        <table class="table align-middle">
            <thead class="table-red">
                <tr>
                    <th style="width:116px">Imagen</th>
                    <th>Nombre</th>
                    <th>Especie</th>
                    <th style="width:300px" class="text-end">Acciones</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var p in Model.Items)
                {
                    <tr data-id="@p.Id">
                        <td>
                            <img src="@p.ImageUrl" class="rounded" width="72" height="72" alt="@p.Name" />
                        </td>
                        <td class="fw-semibold text-capitalize">@p.Name</td>
                        <td class="text-capitalize">@p.SpeciesName</td>
                        <td class="text-end">
                            <div class="d-flex align-items-center justify-content-end gap-2 flex-wrap">

                                <a class="btn btn-sm glossy-btn btn-neo-green"
                                   href="@Url.Action("Details", "Pokemon", new { id = p.Id })">
                                    Detalles
                                </a>

                                <!-- Formulario de envío: input con ancho estable + botón amarillo -->
                                <form method="post"
                                      action="@Url.Action("SendToEmail", "Pokemon")"
                                      class="d-flex align-items-center gap-2">
                                    @Html.AntiForgeryToken()
                                    <input type="hidden" name="id" value="@p.Id" />

                                    <input type="email"
                                           name="toEmail"
                                           class="form-control form-control-sm"
                                           placeholder="correo@dominio.com"
                                           autocomplete="email"
                                           required
                                           style="width: 240px; max-width: 100%;" />

                                    <button type="submit"
                                            class="btn btn-sm glossy-btn btn-neo-yellow">
                                        Enviar correo
                                    </button>
                                </form>

                            </div>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <nav class="d-flex flex-wrap align-items-center justify-content-between gap-2 mt-2" aria-label="paginacion">
        <div class="small text-muted">
            Mostrando @first–@last de @total
        </div>

        <ul class="pagination mb-0">
            <li class="page-item @(page <= 1 ? "disabled" : "")">
                <a class="page-link js-page" data-page="1">&laquo;</a>
            </li>
            <li class="page-item @(page <= 1 ? "disabled" : "")">
                <a class="page-link js-page" data-page="@(page - 1)">Anterior</a>
            </li>

            @if (start > 1)
            {
                <li class="page-item"><a class="page-link js-page" data-page="1">1</a></li>
                <li class="page-item disabled"><span class="page-link">...</span></li>
            }

            @for (var i = start; i <= end; i++)
            {
                <li class="page-item @(i == page ? "active" : "")">
                    <a class="page-link js-page" data-page="@i">@i</a>
                </li>
            }

            @if (end < totalPages)
            {
                <li class="page-item disabled"><span class="page-link">...</span></li>
                <li class="page-item"><a class="page-link js-page" data-page="@totalPages">@totalPages</a></li>
            }

            <li class="page-item @(page >= totalPages ? "disabled" : "")">
                <a class="page-link js-page" data-page="@(page + 1)">Siguiente</a>
            </li>
            <li class="page-item @(page >= totalPages ? "disabled" : "")">
                <a class="page-link js-page" data-page="@totalPages">&raquo;</a>
            </li>
        </ul>
    </nav>
}
